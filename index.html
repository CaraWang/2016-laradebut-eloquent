<!DOCTYPE html>
<html lang="en">
<head>
	<title>Laradebut #5 - 關於 CRUD 外的一點小事</title>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="shower/themes/ribbon/styles/screen-16x10.css">
</head>
<body class="shower list">
	<header class="caption">
		<h1>Laradebut #5 - 關於 CRUD 外的一點小事</h2>
		<p>Cara Wang &lt;caraw@cnyes.com&gt;</p>
	</header>
	<section class="slide" id="cover">
		<h2>Laradebut #5</h2>
		<h3>關於 CRUD 外的一點小事</h3>
		<div class="author">
			<p>@author Cara Wang &lt;caraw@cnyes.com&gt;</p>
			<p>@since 2016/11/29</p>
		</div>
		<img src="pictures/cover.jpg" class="cover">
		<style>
			#cover h2 {
				margin: 14% 0 0;
				padding: 10px;
				color:#f0fcfe;
				text-align:center;
				font-size:60px;
				border-width: 5px;
				border-color: #f0fcfe;
				border-top-style: solid;
				border-bottom-style: solid;
				}
			#cover h3 {
				margin: 18% 0 0;
				color:#f0fcfe;
				text-align:center;
				font-size:30px;
				}
			.author {
				margin-top: 20px;
				margin-left: 248px;
				color:#f0fcfe;
				font-style:italic;
				font-size:20px;
				}
				.author p {
					line-height: 10px;
					text-align:left;
					}
				.author p a {
					color:#f0fcfe;
					}
			#cover img {
				opacity: 0.9;
			}
		</style>
	</section>
	<section class="slide">
		<img src="pictures/cara.png" class="place left">
		<div class="authorDesc">
			<h2>PHP Developer</h2>
			<ol>
				<li class="next">2014/09 ~ now</li>
				<li class="next"><a href="https://codeigniter.com/">CodeIgniter</a></li>
				<li class="next"><a href="https://phalconphp.com/">Phalcon</a></li>
				<li class="next"><a href="https://laravel.com/">Laravel</a></li>
			</ol>
		</div>
		<style>
			.authorDesc {
				margin-left: 445px;
			}
		</style>
	</section>
	<section class="slide">
		<h2>Why Do We Need Framework in PHP ?</h2>
		<ol>
			<li class="next">
				Framework 幫忙做了哪些事 ?
				<ol>
					<li class="next">目錄結構</li>
				</ol>
			</li>
		</ol>
		<style>
			ol ol {
				list-style-type: disc;
			}
			.slide ol ol>li::before {
				content: '';
			}
		</style>
	</section>
	<section class="slide">
		<img src="pictures/codeigniterdir.png" class="cover">
		<h2>CodeIgniter</h2>
	</section>
	<section class="slide">
		<img src="pictures/phalcondir.png" class="cover">
		<h2>Phalcon</h2>
		<a href="https://github.com/phalcon/mvc">Phalcon MVC Examples</a>
	</section>
	<section class="slide">
		<img src="pictures/laraveldir.png" class="cover">
		<h2>Laravel</h2>
	</section>
	<section class="slide">
		<h2>Why Do We Need Framework in PHP ?</h2>
		<ol>
			<li>
				Framework 幫忙做了哪些事 ?
				<ol>
					<li>
						目錄結構
						<ol>
							<li class="next">
								方便協同合作: <span class="next">在同樣的規範與流程下寫程式</span>
							</li>
						</ol>
					</li>
				</ol>
			</li>
		</ol>
		<style>
			ol ol {
				list-style-type: disc;
			}
			.slide ol ol>li::before {
				content: '';
			}
		</style>
	</section>
	<section class="slide">
	<img src="pictures/codeigniterdirmvc.png" class="cover">
		<h2>CodeIgniter</h2>
	</section>
	<section class="slide">
		<img src="pictures/phalcondirmvc.png" class="cover">
		<h2>Phalcon</h2>
	</section>
	<section class="slide">
		<img src="pictures/laraveldirmvc.png" class="cover">
		<h2>Laravel</h2>
	</section>
	<section class="slide">
		<h2>Why Do We Need Framework in PHP ?</h2>
		<ol>
			<li>
				Framework 幫忙做了哪些事 ?
				<ol>
					<li>
						目錄結構
						<ol>
							<li>方便協同合作: <span>在同樣的規範與流程下寫程式</span>
								<ol>
									<li class="next">未來的自己也是一個要合作的對象</li>
								</ol>
							</li>
						</ol>
					</li>
					<li class="next">不用重複造輪子</li>
				</ol>
			</li>
		</ol>
		<style>
			ol ol {
				list-style-type: disc;
			}
			.slide ol ol>li::before {
				content: '';
			}
		</style>
	</section>
	<section class="slide">
		<img src="pictures/hellodemo.png" class="cover">
	</section>
	<section class="slide">
		<figure>
			<img src="pictures/codeigniterhello.png" class="cover">
			<h3>CodeIgniter</h3>
		</figure>
		<style>
			figure h3 {
				margin-top: 50%;
				color: #000;
				font-size: 32px;
			}
		</style>
	</section>
	<section class="slide">
		<figure>
			<img src="pictures/laravelhello.png" class="cover">
			<h3>Laravel</h3>
		</figure>
		<style>
			figure h3 {
				margin-top: 55%;
				color: #000;
				font-size: 32px;
			}
		</style>
	</section>
	<section class="slide">
		<h2>Why Do We Need Framework in PHP ?</h2>
		<ol>
			<li>
				Framework 幫忙做了哪些事 ?
				<ol>
					<li>
						目錄結構
						<ol>
							<li>方便協同合作: <span>在同樣的規範下寫程式</span></li>
						</ol>
					</li>
					<li>
						不用重複造輪子
						<ol>
							<li class="next">專注在開發要提供的服務上</li>
							<li class="next">加速完成速度</li>
						</ol>
					</li>
				</ol>
			</li>
		</ol>
		<style>
			ol ol {
				list-style-type: disc;
			}
			.slide ol ol>li::before {
				content: '';
			}
		</style>
	</section>
	<section class="slide">
		<h2>Why Do We Need Framework in PHP ?</h2>
		<ol>
			<li class="next">
				依據自家需求來選擇 Framework
				<ol>
					<li class="next">擇你所愛，愛你所選</li>
					<li class="next">享受 Framework 提供的功能來合作與開發更快速</li>
					<li class="next">跟你的 Framwork 學習</li>
				</ol>
			</li>
		</ol>
		<style>
			ol ol {
				list-style-type: disc;
			}
			.slide ol ol>li::before {
				content: '';
			}
		</style>
	</section>
	<section class="slide">
		<h2>Why Do We Use Laravel ?</h2>
		<ol>
			<li class="next"><a href="http://www.slideshare.net/shengyou/phpconf-taiwan-2015-laravel-51-php">跟著 Laravel 5.1 一起成為更好的開發者</a>
				<ol>
					<li class="next">
						快速的跟上語言版本 -> PHP7
						<ol><li class="next"><a href="https://laravel-news.com/2016/10/laravel-v4-2-20/">V4.2.20 is now released with support for PHP 7.0</a></li></ol>
					</li>
				</ol>
			</li>
		</ol>
		<style>
			ol ol {
				list-style-type: disc;
			}
			.slide ol ol>li::before {
				content: '';
			}
		</style>
	</section>
	<section class="slide">
		<img src="pictures/laravelgood1.png" class="cover">
	</section>
	<section class="slide">
		<h2>Why Do We Use Laravel ?</h2>
		<ol>
			<li><a href="http://www.slideshare.net/shengyou/phpconf-taiwan-2015-laravel-51-php">跟著 Laravel 5.1 一起成為更好的開發者</a>
				<ol>
					<li>快速的跟上語言版本 -> PHP7</li>
					<li class="next">遵循標準: <a href="http://www.php-fig.org/psr/psr-2/">PSR-2</a> & <a href="http://www.php-fig.org/psr/psr-4/">PSR-4</a></li>
				</ol>
			</li>
		</ol>
		<style>
			ol ol {
				list-style-type: disc;
			}
			.slide ol ol>li::before {
				content: '';
			}
		</style>
	</section>
	<section class="slide">
		<img src="pictures/laravelgood2.png" class="cover">
	</section>
	<section class="slide">
		<h2>Why Do We Use Laravel ?</h2>
		<ol>
			<li><a href="http://www.slideshare.net/shengyou/phpconf-taiwan-2015-laravel-51-php">跟著 Laravel 5.1 一起成為更好的開發者</a>
				<ol>
					<li>快速的跟上語言版本 -> PHP7</li>
					<li>遵循標準: <a href="http://www.php-fig.org/psr/psr-2/">PSR-2</a> & <a href="http://www.php-fig.org/psr/psr-4/">PSR-4</a></li>
					<li class="next">整合套件管理工具: <a href="https://getcomposer.org/">Composer</a> & <a href="https://www.npmjs.com/">npm</a></li>
				</ol>
			</li>
		</ol>
		<style>
			ol ol {
				list-style-type: disc;
			}
			.slide ol ol>li::before {
				content: '';
			}
		</style>
	</section>
	<section class="slide">
		<img src="pictures/laravelgood3.png" class="cover">
	</section>
	<section class="slide">
		<h2>Why Do We Use Laravel ?</h2>
		<ol>
			<li><a href="http://www.slideshare.net/shengyou/phpconf-taiwan-2015-laravel-51-php">跟著 Laravel 5.1 一起成為更好的開發者</a>
				<ol>
					<li>快速的跟上語言版本 -> PHP7</li>
					<li>遵循標準: <a href="http://www.php-fig.org/psr/psr-2/">PSR-2</a> & <a href="http://www.php-fig.org/psr/psr-4/">PSR-4</a></li>
					<li>整合套件管理工具: <a href="https://getcomposer.org/">Composer</a> & <a href="https://www.npmjs.com/">npm</a></li>
					<li class="next">學習 Design Pattern</li>
				</ol>
			</li>
		</ol>
		<style>
			ol ol {
				list-style-type: disc;
			}
			.slide ol ol>li::before {
				content: '';
			}
		</style>
	</section>
	<section class="slide">
		<img src="pictures/laravelgood4.png" class="cover">
	</section>
	<section class="slide">
		<h2>Why Do We Use Laravel ?</h2>
		<ol>
			<li class="next">安心的跟著 Laravel 一起成長</li>
		</ol>
		<style>
			ol ol {
				list-style-type: disc;
			}
			.slide ol ol>li::before {
				content: '';
			}
		</style>
	</section>
	<section class="slide">
		<img src="pictures/josh.jpeg" class="cover">
		<h3>By <a href="https://github.com/codeguy">Josh Lockhart</a> @ 2016 PHPConf Taiwan</h3>
	</section>
	<section class="slide">
		<h2>Introduction to Eloquent</h2>
		<ol>
			<li class="next">Laravel 提供的 <a href="https://en.wikipedia.org/wiki/Object-relational_mapping">ORM</a></li>
			<li class="next">Why Do We Need ORM ?</li>
		</ol>
		<style>
			ol ol {
				list-style-type: disc;
			}
			.slide ol ol>li::before {
				content: '';
			}
		</style>
	</section>
	<section class="slide">
		<img src="pictures/orm.png" class="cover">
	</section>
	<section class="slide">
		<h2>Introduction to Eloquent</h2>
		<ol>
			<li>Laravel 提供的 <a href="https://en.wikipedia.org/wiki/Object-relational_mapping">ORM</a></li>
			<li>
				Why Do We Need ORM ?
				<ol>
					<li class="next">Keep it simple</li>
					<li class="next">方便協同合作</li>
					<li class="next">安全性考量: <span class="next"><a href="https://en.wikipedia.org/wiki/SQL_injection">SQL Injection</a></span></li>
				</ol>
			</li>
		</ol>
		<style>
			ol ol {
				list-style-type: disc;
			}
			.slide ol ol>li::before {
				content: '';
			}
		</style>
	</section>
	<section class="slide">
		<h2>Introduction to Eloquent</h2>
		<ol>
			<li class="next">
				如何使用
				<ol>
					<li class="next">你有一個 Model</li>
				</ol>
			</li>
		</ol>
		<pre class="next">
			<code>&lt?php</code>
			<code>namespace App;</code>
			<code>use <mark>Illuminate\Database\Eloquent\Model</mark>;</code>
			<code>class Product extends <mark>Model</mark></code>
			<code>{</code>
			<code>}</code>
		</pre>
		<style>
			ol ol {
				list-style-type: disc;
			}
			.slide ol ol>li::before {
				content: '';
			}
		</style>
	</section>
	<section class="slide">
		<h2>Introduction to Eloquent</h2>
		<ol>
			<li>如何使用
				<ol>
					<li class="next">你開始使用 Model</li>
				</ol>
			</li>
		</ol>
		<pre class="next">
			<code>Product::select('name', 'price')</code>
			<code>    ->where('discount', '&lt', 1)</code>
			<code>    ->first();</code>
		</pre>
		<style>
			ol ol {
				list-style-type: disc;
			}
			.slide ol ol>li::before {
				content: '';
			}
		</style>
	</section>
	<section class="slide">
		<h2>Introduction to Eloquent</h2>
		<ol>
			<li>如何使用</li>
				<ol>
					<li class="next">實際上組出來的 SQL</li>
						<li class="next">可以透過 <mark>->toSql()</mark> 取得 ORM 實際組出來的 SQL</li>
						<li class="next">可以透過 <mark>->getBindings()</mark> 取得 傳給 SQL 的變數</li>
				</ol>
			</li>
		</ol>
		<pre class="next">
			<code>SELECT `name`, `price`</code>
			<code>FROM `product`</code>
			<code>WHERE `discount` &lt 1;</code>
		</pre>
		<style>
			ol ol {
				list-style-type: disc;
			}
			.slide ol ol>li::before {
				content: '';
			}
		</style>
	</section>
	<section class="slide">
		<h2>Introduction to Eloquent</h2>
		<pre class="next smallCode">
			<code>CREATE TABLE `products` (</code>
			<code>    `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT '商品流水號',</code>
			<code>    `name` varchar(255) COLLATE utf8_unicode_ci NOT NULL COMMENT '商品名稱',</code>
			<code>    `brand` varchar(255) COLLATE utf8_unicode_ci NOT NULL COMMENT '品牌',</code>
			<code>    `type` varchar(255) COLLATE utf8_unicode_ci DEFAULT '' COMMENT '商品型號',</code>
			<code>    <mark>`price`</mark> double(8,2) NOT NULL,</code>
			<code>    `discount` double(8,2) NOT NULL DEFAULT '1.00',</code>
			<code>    `created_at` timestamp NULL DEFAULT NULL,</code>
			<code>    `updated_at` timestamp NULL DEFAULT NULL,</code>
			<code>    PRIMARY KEY (`id`),</code>
			<code>) ENGINE=InnoDB AUTO_INCREMENT=1058 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;</code>
		</pre>
		<style>
			ol ol {
				list-style-type: disc;
			}
			.slide ol ol>li::before {
				content: '';
			}
			.smallCode code {
				font-size: 18px;
			}
		</style>
	</section>
	<section class="slide">
		<h2>Introduction to Eloquent</h2>
		<ol>
			<li class="next">價格要乘以折扣數:<span class="next">你可以這樣寫</span>
				<ol>
					<li class="next">分別取出 <mark>price</mark> 和 <mark>discount</mark></li>
					<li class="next">相乘後在顯示到頁面上</li>
					<li class="next">還要小心記得要做四捨五入</li>
				</ol>
			</li>
			<li class="next">但你用的是 Laravel， 所以你有更好的選擇
				<ol>
					<li class="next">使用 Accessors</li>
				</ol>
			</li>
		</ol>
	</section>
	<section class="slide">
		<pre>
			<code>public function getPriceAttribute()</code>
 			<code>{</code>
			<code>    $price = (float)$this->attributes['price'];</code>
			<code>    $discount = (float)$this->attributes['discount'];</code>
			<code>    return (int) ceil($price * $discount);</code>
			<code>}</code>
		</pre>
	</section>
	<section class="slide">
		<img src="pictures/accessor.png" class="cover">
	</section>
	<section class="slide">
		<h2>Introduction to Eloquent</h2>
		<ol>
			<li class="next">
				如果 <mark>discount</mark> 存錯值，問題就大條了!
				<ol>
					<li class="next">不小心存成大於 <mark>1</mark> 的值</li>
					<li class="next">公司規定折扣數不會低於五折</li>
				</ol>
			</li>
			<li class="next">你可以這樣寫
				<ol>
					<li class="next">寫一個 <mark>checkValidDiscount(...)</mark> 的 Helper function</li>
					<li class="next">每次存入前就檢查一下</li>
				</ol>
			</li>
			<li class="next">但你用的是 Laravel， 所以你有更好的選擇
				<ol>
					<li class="next">使用 Mutator</li>
				</ol>
			</li>
		</ol>
	</section>
	<section class="slide">
		<pre>
			<code>public function setDiscountAttribute($value)</code>
			<code>{</code>
			<code>    if ($value > 1) {</code>
			<code>        $value = 1;</code>
			<code>    } elseif ($value < 0.5) {</code>
			<code>        $value = 0.5;</code>
			<code>    }</code>
			<code> </code>
			<code>    $this->attributes['discount'] = $value;</code>
			<code>}</code>
		</pre>
	</section>
	<section class="slide">
		<img src="pictures/mutator.png" class="cover">
	</section>
	<section class="slide">
		<h2>Introduction to Eloquent</h2>
		<ol>
			<li class="next">其他 Accessors 的例子</li>
			<li class="next">
				品名包含: <span class="next">【品牌】</span><span class="next">品名</span><span class="next"> - 型號</span>
			</li>
		</ol>
	</section>
	<section class="slide">
		<h2>Introduction to Eloquent</h2>
		<ol>
			<li class="next">你可以這樣寫
				<ol>
					<li class="next"><mark>getProductName(...)</mark> 的 Helper function</li>
					<li class="next">從 Model 拿出 <mark>name</makr>、<mark>brand</makr>、<mark>type</mark></li>
					<li class="next">一一丟進 <mark>getProductName(...)</mark> 中組出 【品牌】品名 - 型號</li>
				</ol>
			</li>
			<li class="next">但你用的是 Laravel， 所以你有更好的選擇
				<ol>
					<li class="next">使用 Accessors</li>
				</ol>
			</li>
		</ol>
	</section>
	<section class="slide">
		<pre>
			<code>public function getFullNameAttribute()</code>
 			<code>{</code>
			<code>    return sprintf(</code>
			<code>        '【%s】%s - %s',</code>
			<code>        $this->attributes['brand'],</code>
			<code>        $this->attributes['name'],</code>
			<code>        $this->attributes['type']</code>
			<code>    );</code>
			<code>}</code>
		</pre>
	</section>
	<section class="slide">
		<img src="pictures/accessor1.png" class="cover">
	</section>
	<section class="slide">
		<h2>Introduction to Eloquent</h2>
		<ol>
			<li class="next">其他 Mutators 的例子</li>
			<li class="next">型號是顏色的話，結尾一定要是 <mark>色</mark></li>
		</ol>
	</section>
	<section class="slide">
		<pre class="smallCode">
			<code>public function setTypeAttribute($value)</code>
			<code>{</code>
			<code>    if (((int)stripos($value, '色') - 1) !== mb_strlen($value)</code>
			<code>            && in_array($value, self::$colors)) {</code>
			<code>        $value .= '色';</code>
			<code>    }</code>
			<code> </code>
			<code>    $this->attributes['type'] = $value;</code>
			<code>}</code>
		</pre>
		<style>
			.smallCode code {
				font-size: 23px;
			}
		</style>
	</section>
	<section class="slide">
		<img src="pictures/mutator1.png" class="cover">
	</section>
	<section class="slide">
		<h2>Introduction to Eloquent</h2>
		<ol>
			<li class="next">
				其他關於 Eloquent 的小事
				<ol>
					<li class="next">設定 <mark>attributes</mark> 預設值</li>
				</ol>
			</li>
		</ol>
	</section>
	<section class="slide">
		<pre>
			<code>protected $attributes = [</code>
			<code>    'brand' =&gt 'Laradebut'</code>
			<code>    'type' =&gt ''</code>
			<code>];</code>
		</pre>
	</section>
	<section class="slide">
		<h2>Introduction to Eloquent</h2>
		<ol>
			<li>
				其他關於 Eloquent 的小事
				<ol>
					<li>設定 <mark>attributes</mark> 預設值</li>
					<li class="next">
						設定 <mark>casts</mark> 資料型別
						<ol>
							<li class="next"><mark>price</mark> 必須是 integer</li>
						</ol>
					</li>
				</ol>
			</li>
		</ol>
	</section>
	<section class="slide">
		<pre>
			<code>protected $casts = [</code>
			<code>    'price'    =&gt 'int',</code>
			<code>    'discount' =&gt 'float'</code>
			<code>];</code>
		</pre>
	</section>
	<section class="slide">
		<h2>Introduction to Eloquent</h2>
		<ol>
			<li>
				其他關於 Eloquent 的小事
				<ol>
					<li>設定 <mark>attributes</mark> 預設值</li>
					<li>
						設定 <mark>casts</mark> 資料型別
						<ol>
							<li><mark>price</mark> 必須是 integer</li>
							<li class="next">有個小問題兒: 如果你用了 Mutator，設定 <mark>$casts</mark> 就會無效 <code>in version: 5.3.24</code></li>
						</ol>
					</li>
					<li class="next">設定 <mark>appends</mark> 輸出必須欄位</li>
				</ol>
			</li>
		</ol>
	</section>
	<section class="slide">
		<pre>
			<code>protected $appends = ['fullName'];</code>
		</pre>
	</section>
	<section class="slide">
		<img src="pictures/appends.png" class="cover">
	</section>
	<section class="slide">
		<h2>Introduction to Eloquent</h2>
		<ol>
			<li>
				其他關於 Eloquent 的小事
				<ol>
					<li>設定 <mark>attributes</mark> 預設值</li>
					<li>
						設定 <mark>casts</mark> 資料型別
						<ol>
							<li><mark>price</mark> 必須是 integer</li>
							<li>有個小問題兒: 如果你用了 Mutator，設定 <mark>$casts</mark> 就會無效 <code>in version: 5.3.24</code></li>
						</ol>
					</li>
					<li>設定 <mark>appends</mark> 輸出必須欄位</li>
					<li class="next">
						設定 <mark>CREATED_AT</mark> 和 <mark>UPDATED_AT</mark>
						<ol>
							<li class="next">migration 得要自己設定</li>
						</ol>
					</li>
				</ol>
			</li>
		</ol>
	</section>
	<section class="slide">
		<pre>
			<code>$table->timestamp('createdAt')->nullable();</code>
			<code>$table->timestamp('updatedAt')->nullable();</code>
		</pre>
	</section>
	<section class="slide">
		<h2>Why Do We Use Laravel ?</h2>
		<ol>
			<li class="next">跟你的 Framwork 學習</li>
			<li class="next">練習看 Source Code</li>
			<li class="next"><a href="https://github.com/CaraWang/laradebut-5-demo">Demo Code</a></li>
		</ol>
	</section>
	<section class="slide" id="end">
		<h2>Q & A</h2>
		<img src="pictures/end.jpg" alt="" class="cover">
		<!--
			To apply styles to the certain slides
			set slide ID to get needed elements
			-->
		<style>
			#end h2 {
				margin: 350px 0 0;
				padding: 10px;
				color:#DB2F13;
				text-align:right;
				font-size:60px;
				}
		</style>
	</section>
	<p class="badge">
		<a href="https://github.com/CaraWang/2016-laradebut-eloquent">Fork me on GitHub</a>
	</p>
	<!--
		To hide progress bar from entire presentation
		just remove “progress” element.
		-->
	<div class="progress"></div>
	<script src="shower/shower.min.js"></script>
	<!-- Copyright © 2015 Yours Truly, Famous Inc. -->
	<!-- Photos by John Carey, fiftyfootshadows.net -->
</body>
</html>
